{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Maze Test</title>
    <style>
        body {
            margin: 0;
            background: #0e2d14;
            color: white;
            font-family: 'Comic Sans MS', cursive;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        canvas {
            border: 4px solid #74c69d;
            border-radius: 10px;
            box-shadow: 0 0 20px #2d6a4f;
            background: linear-gradient(180deg,#144d28,#0b3316);
        }

        button {
            background: linear-gradient(145deg,#40916c,#95d5b2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>AI Pathfinding Demo</h1>
    <canvas id="mazeCanvas" width="800" height="600"></canvas>
    <button id="startAi">🤖 Run AI Turn</button>

    <script>
        // setup canvas and maze grid
        const canvas = document.getElementById("mazeCanvas"), ctx = canvas.getContext("2d");
        const rows = 10, cols = 15, tileSize = 40;
        const maze = Array(rows).fill().map(() => Array(cols).fill(1));

        // create simple open maze
        for (let r = 1; r < rows - 1; r++) { for (let c = 1; c < cols - 1; c++)maze[r][c] = 0; }
        maze[1][1] = 0; maze[rows - 2][cols - 2] = 0;

        // add some locked doors
        const doors = [{ row: 3, col: 5, locked: true }, { row: 5, col: 8, locked: true }, { row: 7, col: 11, locked: true }];

        // define AI start and goal
        let ai = { row: 1, col: 1, color: "#9d4edd" };
        const endRow = rows - 2, endCol = cols - 2;

        // draw maze and AI
        function drawMaze() {
            ctx.fillStyle = "#0b3316"; ctx.fillRect(0, 0, canvas.width, canvas.height);
            for (let r = 0; r < rows; r++) { for (let c = 0; c < cols; c++) { if (maze[r][c] === 1) { ctx.fillStyle = "#081c0c"; ctx.fillRect(c * tileSize, r * tileSize, tileSize, tileSize); } } }
            ctx.fillStyle = "#0ea5e9"; ctx.fillRect(endCol * tileSize, endRow * tileSize, tileSize, tileSize);
            for (const d of doors) { ctx.fillStyle = d.locked ? "#78350f" : "#22c55e"; ctx.fillRect(d.col * tileSize, d.row * tileSize, tileSize, tileSize); }
            const px = ai.col * tileSize + tileSize / 2, py = ai.row * tileSize + tileSize / 2;
            ctx.beginPath(); ctx.arc(px, py, tileSize / 4, 0, Math.PI * 2); ctx.fillStyle = ai.color; ctx.fill();
        }
        drawMaze();

        // pause for animation
        function sleep(ms) { return new Promise(res => setTimeout(res, ms)); }

        // AI automatic movement
        async function aiTurn() {
            document.getElementById("startAi").disabled = true;
            const aiRoll = Math.floor(Math.random() * 6) + 1;
            alert(`🤖 AI rolled ${aiRoll}`);
            let movesLeft = aiRoll;
            const directions = [[0, 1], [1, 0], [0, -1], [-1, 0]]; // right, down, left, up

            while (movesLeft > 0) {
                let moved = false;
                for (let i = 0; i < directions.length; i++) {
                    const [dr, dc] = directions[i]; const nr = ai.row + dr, nc = ai.col + dc;
                    if (nr >= 0 && nr < rows && nc >= 0 && nc < cols && maze[nr][nc] === 0) {
                        if (i === 3 && moved) continue;
                        const door = doors.find(d => d.row === nr && d.col === nc);
                        if (door) {
                            const success = Math.random() < 0.5;
                            if (success) { alert("🤖 AI passed the door!"); door.locked = false; ai.row = nr; ai.col = nc; }
                            else { alert("🤖 AI failed at the door!"); movesLeft--; drawMaze(); await sleep(400); moved = true; break; }
                        } else { ai.row = nr; ai.col = nc; }
                        drawMaze(); await sleep(400); movesLeft--; moved = true; break;
                    }
                }
                if (!moved) { alert("🤖 AI is trapped!"); break; }
                if (ai.row === endRow && ai.col === endCol) { alert("🎉 AI reached the goal!"); document.getElementById("startAi").disabled = false; return; }
            }
            alert("🤖 AI turn done!"); document.getElementById("startAi").disabled = false;
        }

        // start AI run when button pressed
        document.getElementById("startAi").addEventListener("click", aiTurn);
    </script>
</body>
</html>
